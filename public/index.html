<!DOCTYPE html><html lang="en"><head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="style.css" />
    <script type="text/javascript">
    var socket = io.connect();
    var currentId;
    var activeUser = false;

    socket.on('mousemove',function(data){
      //console.log('client data'+data);
      if (document.getElementById(data.id)) {
        var div = document.getElementById(data.id);
        div.style.left = data.mouse.x + "px";
        div.style.top = data.mouse.y + "px"; 
      }
    });

    socket.on('removeOldImage', function(data){
      console.log(data);
      if (document.getElementById(data)) {
      document.getElementById(data).remove();
      }
    });

    socket.on('createNewImage', function(data){
      console.log('new socket id: '+data);
      var pointerImg=document.createElement("IMG");
      pointerImg.src="https://www.pinclipart.com/picdir/big/375-3752865_free-png-download-mouse-svg-cursor-mac-png.png";
      pointerImg.id = data;
      pointerImg.classList.add("pointerClass");
      currentId = data;
      var main =document.getElementById('Main');
      main.appendChild(pointerImg);

      var ul=document.getElementById("paragraph");
      var li=document.createElement("li");
      li.innerHTML="new guy joins";
      aText.push(li.innerHTML);
      typewriter();
    });

    socket.on('lostClient',function(data){
      console.log('lost client: '+  data);
    });

    window.addEventListener('load',function() {
      var startTime = Date.now();
          typewriter();

      document.addEventListener('mousemove',function(e){
          // console.log('Send pos:' + e.clientX + ',' + e.clientY);
            var data = {
              x : e.clientX,
              y : e.clientY
            }
          document.getElementById("pointer").style.left = data.x + "px";
          document.getElementById("pointer").style.top = data.y + "px"; 
          socket.emit('mousemove', data);
        });

      document.addEventListener('click', function(event) {
          getGeolocation();
          //console.log(event.target.classList);
          var click_li = document.createElement("click_li");
          click_li.innerHTML = "You clicked at " + ((Date.now() - startTime)/1000);
          aText.push(click_li.innerHTML);
          typewriter();

          socket.emit('click', ((Date.now() - startTime)/1000));
        });

      document.querySelectorAll('.pointerClass').forEach(pointer => {
        //addeventlistener to every object in pointer img array
        pointer.addEventListener('click', function(event,data) {
          console.log("I'm been clicked, my socket id is " );
          console.log(event.currentTarget.id);
          // ?how to get the socket.id of the client?
          console.log(data);
          //send getLocation request to the server
          socket.emit('getLocationFrom', data);

        })
      })

      window.addEventListener("resize", function(){
          console.log("resize");
          var windowY = window.innerHeight;
          console.log( "windowY=" + windowY );
          document.getElementById('box').style.height = windowY+"px";
        });

      });
    </script>
</head>

  <body>
    <div class="box" id="box">
      <div id="typedtext"></div>
      <div id="Main">
         <img class="pointerClass" id="pointer" src="https://www.pinclipart.com/picdir/big/375-3752865_free-png-download-mouse-svg-cursor-mac-png.png" />
         <div id="myDiv" style="position:absolute; top:0px; left:0px;" >
      </div>
    </div>
    <script src="./index.js"></script>
    <script async defer
    src="https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyAqZFDlgJDvZdHIOkPbpwl3bribyCC4fYQ">
    </script>
  </body>
</html>
